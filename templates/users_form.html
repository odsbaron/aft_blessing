{% extends "base.html" %}

{% block title %}
{% if user %}编辑用户 - {{ user.name }}{% else %}添加用户{% endif %} - 生日祝福管理系统
{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-{% if user %}edit{% else %}user-plus{% endif %}"></i>
    {% if user %}编辑用户{% else %}添加用户{% endif %}</h1>
    <div class="page-actions">
        <a href="{{ url_for('users_list') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> 返回列表
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="post" class="form">
            <div class="form-group">
                <label for="name">姓名 <span class="required">*</span></label>
                <input type="text" id="name" name="name" class="form-control" required
                       value="{% if user %}{{ user.name }}{% endif %}"
                       placeholder="请输入姓名">
            </div>

            <div class="form-group">
                <label for="email">邮箱 <span class="required">*</span></label>
                <input type="email" id="email" name="email" class="form-control" required
                       value="{% if user %}{{ user.email }}{% endif %}"
                       placeholder="example@email.com">
            </div>

            <div class="form-group">
                <label for="dob">生日 <span class="required">*</span></label>
                <input type="date" id="dob" name="dob" class="form-control" required
                       value="{% if user %}{{ user.dob_for_form or user.dob }}{% endif %}">
                <small class="form-text">格式：YYYY-MM-DD，如：1990-01-15。也支持 YYYY/M/D 或 YYYY.M.D 格式</small>
            </div>

            {% if user %}
            <div class="form-group">
                <label for="last_sent_year">上次发送年份</label>
                <input type="number" id="last_sent_year" name="last_sent_year" class="form-control"
                       value="{% if user.last_sent_year %}{{ user.last_sent_year }}{% endif %}"
                       min="2020" max="2030">
                <small class="form-text">留空表示未发送过</small>
            </div>
            {% endif %}

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> {% if user %}保存修改{% else %}添加用户{% endif %}
                </button>
                <a href="{{ url_for('users_list') }}" class="btn">取消</a>
            </div>
        </form>
    </div>
</div>

{% if user %}
<div class="card">
    <div class="card-header">
        <h2><i class="fas fa-info-circle"></i> 用户信息</h2>
    </div>
    <div class="card-body">
        <dl class="detail-list">
            <dt>用户ID</dt>
            <dd>{{ user.id }}</dd>

            <dt>创建时间</dt>
            <dd>{{ user.created_at }}</dd>

            <dt>更新时间</dt>
            <dd>{{ user.updated_at }}</dd>

            <dt>年龄</dt>
            <dd>{{ user.age }} 岁</dd>
        </dl>
    </div>
</div>
{% endif %}
{% endblock %}
